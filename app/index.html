<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<title>ETL</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
		<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.css">
		<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
		<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.js"></script>
		<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.5/js/dataTables.buttons.min.js"></script>
		<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.flash.min.js"></script>
		<script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
		<script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
		<script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
		<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.html5.min.js"></script>
		<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.print.min.js"></script>
		<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>
	</head>
	<body>
		<nav class="navbar navbar-light" style="background-color: #e3f2fd;">
			<div class="container-fluid">
		    	<span class="navbar-brand mb-0 h1" style="font-size: 40px;">ETL</span>
		    </div>
		</nav>

		</br>
		</br>

		<div class="d-grid gap-2 col-6 mx-auto">
			<button class="btn btn-primary" type="button" onclick="extract()">Extract</button>
			<p class="info"></p>
			<button class="btn btn-primary" type="button" onclick="transform()" disabled>Transform</button>
			<p class="info"></p>
			<button class="btn btn-primary" type="button" onclick="load()" disabled>Load</button>
			<p class="info"></p>
		</div>

		</br>
		</br>
		</br>
		</br>
		<button type="button" class="btn btn-danger" onclick="clearDb()">Clear database</button>

		<table class="table" id="table">
			<thead class="thead-dark">
				<tr>
					<th scope="col">Currency Name</th>
					<th scope="col">Symbol</th>
					<th scope="col">Exchange</th>
					<th scope="col">Transition</th>
					<th scope="col">Transition PLN</th>
					<th scope="col">Source</th>
					<th scope="col">Source URL</th>
					<th scope="col">Date</th>
				</tr>
			</thead>
		</table>
		
		<script>
			var displayDb = function(){
    			$('#table').DataTable({
					ajax: {
						url: "http://127.0.0.1:5000/currencies/",
						dataSrc: "data"
					},
					columns: [
						{data: 'currency_name'},
						{data: 'symbol'},
						{data: 'exchange'},
						{data: 'transition'},
						{data: 'transition_pln'},
						{data: 'source'},
						{data: 'source_url'},
						{data: 'date'},
					],
					dom: "Bfrtip",
					buttons: [
						{
							extend: "csv",
							text: "Export to csv",
							exportOptions: {
                    			modifier: {
                        			selected: null
                    			}
                			}
						},
						{
							extend: "csv",
							text: "Export selected to csv"
						}
					],
					select: true,
					select: {
						style: "multi"
					}
				});
			}();
			function extract(){
				fetch("http://127.0.0.1:5000/extract/")
					.then(function(response){
						return response.json();
					})
					.then(function(data){
						document.getElementsByClassName("info")[0].innerHTML = data["msg"]
						if(data["success"]){
							document.getElementsByClassName("btn")[1].disabled = false
							document.getElementsByClassName("info")[1].innerHTML = ""
							document.getElementsByClassName("info")[2].innerHTML = ""

						}
					})
			}
			function transform(){
				fetch("http://127.0.0.1:5000/transform/")
					.then(function(response){
						return response.json();
					})
					.then(function(data){
						document.getElementsByClassName("info")[1].innerHTML = data["msg"]
						if(data["success"]){
							document.getElementsByClassName("btn")[2].disabled = false
							document.getElementsByClassName("info")[0].innerHTML = ""

						}
					})
			}
			function load(){
				fetch("http://127.0.0.1:5000/load/")
					.then(function(response){
						return response.json();
					})
					.then(function(data){
						document.getElementsByClassName("info")[2].innerHTML = data["msg"];
						if(data["success"]){
							document.getElementsByClassName("btn")[1].disabled = true;
							document.getElementsByClassName("btn")[2].disabled = true;
							document.getElementsByClassName("info")[0].innerHTML = "";
							document.getElementsByClassName("info")[1].innerHTML = "";
							$("#table").DataTable().rows.add(data["data"]).draw();
						}
					})
			}
			function clearDb(){
				fetch("http://127.0.0.1:5000/currencies/", {
					method: "DELETE"
				})
				.then(function(response){
					$("#table").DataTable().clear().draw();
				})
			}
			function csv(){
				const csvString = [
					
				]
			}
		</script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
	</body>
</html>
